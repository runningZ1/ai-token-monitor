## 产品名称（暂定）

ChatGPT Token 使用表盘（Chrome 扩展版）

## 1. 产品背景与目标

### 1.1 背景

越来越多的人在日常工作和生活中高频使用各类 AI 工具（尤其是 ChatGPT），但大多数用户并不了解自己在这些工具中到底“烧”了多少 token，也缺乏一个统一视角来回顾自己的使用习惯。

目前各平台对 token 使用情况的反馈分散、不统一，一般只在账单或接口返回中以较技术化的方式呈现，普通用户难以感知，也不方便从长期角度做对比和复盘。

### 1.2 产品目标

为经常使用 ChatGPT 的用户提供一个「量化自己 token 使用情况和对话习惯」的本地仪表盘，帮助用户：

- 感知自己在不同时间段的 ChatGPT 使用强度；
- 粗略了解自己的输入 / 输出 / 总 token 使用量；
- 观察对话轮数与使用模式的变化趋势；
- 后续具备扩展为更专业统计和多平台聚合的基础。

本期 V1 仅聚焦 ChatGPT 网页端 + Chrome 浏览器 + 免费版粗略统计，以尽快验证产品价值和交互体验。

## 2. 目标用户与使用场景

### 2.1 目标用户

- 轻度或重度使用 ChatGPT 的个人用户；
- 包括开发者、知识型工作者、学生等；
- 当前阶段主要是使用 Chrome 浏览器 + ChatGPT 网页版的用户。

### 2.2 典型使用场景

- 用户每天使用 ChatGPT 处理工作 / 学习任务，希望了解：
  - 自己最近一天 / 一周 / 一个月大概用了多少 token；
  - 哪些模式（如 GPT‑5.1 / Thinking / Instant / Pro 等）使用得更多；
  - 自己大概发了多少轮对话。
- 用户对隐私敏感，不希望聊天内容被上传或长期保存，但可以接受本地的元数据统计。
- 用户希望以简单直观的表盘方式浏览这些数据，而不是阅读原始日志或开发者控制台。

## 3. 范围与不做的内容（V1）

### 3.1 本期范围（V1）

- 平台与来源：
  - 仅统计 ChatGPT 网页版：`https://chatgpt.com/c/...`；
  - 仅支持 Chrome 浏览器。
- 数据采集：
  - 通过浏览器扩展注入内容脚本，监听 ChatGPT 对话页面的 DOM 变化；
  - 抓取用户输入气泡与 AI 回复气泡的文本长度等信息。
- 统计维度：
  - 输入 token（估算）、输出 token（估算）、总 token；
  - 总对话轮数；
  - 时间维度（最近 24 小时 / 最近 7 天 / 最近 30 天）；
  - ChatGPT 模式维度（不同模式的用量拆分 + 总和）。
- 展示形态：
  - 浏览器扩展 + dashboard 网页；
  - 点击扩展图标 → 打开 / 跳转到 dashboard 页面 → 展示表盘。
- 权限与隐私：
  - 不保存原文内容，仅保存元数据（长度、时间、模式、会话 URL 等）；
  - 所有数据仅保存在本地浏览器中；
  - 提供一键清空所有统计数据的能力。

### 3.2 明确不做（或后续版本）内容

- 不统计：
  - 非 ChatGPT 平台（如豆包、API 调用、CLI 工具等）——后续版本再扩展；
  - 移动端 App、桌面原生应用中的使用情况。
- 不实现：
  - 云端账号与多设备同步；
  - 团队版 / 多人聚合统计；
  - 更精确的 tokenizer 级 token 计算；
  - 付费版高级功能与更复杂的分析视图；
  - 多语言（V1 仅中文界面）。

## 4. 口径与名词定义

### 4.1 会话（Session）

- 定义：每个 ChatGPT 对话页面 URL（例如 `https://chatgpt.com/c/69194e80-ece8-8330-b7dc-24c2244cec0e`）视为一个会话。

### 4.2 消息（Message）

- 用户在 ChatGPT 对话框中发送的一条输入视为一条「用户消息」；
- ChatGPT 返回的一条完整回复视为一条「AI 消息」。

### 4.3 对话轮数（Turn）

- 定义：用户发一条消息 + 紧随其后的 AI 一条回复 = 1 轮对话；
- 如果存在连续多条用户消息或连续多条 AI 消息，需按规则映射为轮数（具体实现可在技术设计中细化，但对用户口径保持一问一答为一轮）。

### 4.4 模式（Mode）

- 定义：ChatGPT 网页中用户选择的不同模型 / 模式，如：
  - GPT‑5.1；
  - Auto（自动决定思考时长）；
  - Instant（即刻回答）；
  - Thinking（思考更充分，回答更优质）；
  - GPT‑5；
  - Pro（研究级智能模型）；
  - 等。
- 要求：
  - V1 统计当前网页所有模式的总用量；
  - 同时按各模式单独统计用量（两者为总和关系）；
  - 模式识别基于前端可获取信息，允许存在少量误差。

### 4.5 token 估算口径（粗略）

- 不保存原文内容，不依赖官方 usage 字段；
- 通过 DOM 抽取消息文本的长度信息（字符数/字数）进行粗略估算；
- 输入 / 输出 token：
  - 用户消息的估算值记为输入 token；
  - AI 回复的估算值记为输出 token；
  - 会话 / 时间段总 token 为上述两者之和；
- 对用户说明这是一个「粗略估算」，可能存在一定比例的误差（如 10–30%），但足以用于感知趋势与大致用量。

## 5. 功能需求（V1 免费版）

### 5.1 浏览器扩展行为

#### 5.1.1 安装与权限

- 用户在 Chrome 中安装扩展；
- 扩展请求访问 `chatgpt.com` 的必要权限；
- 用户同意后，扩展可以在 ChatGPT 对话页面注入内容脚本。

#### 5.1.2 数据采集

- 在 `https://chatgpt.com/c/...` 对话页面：
  - 监听 DOM 变化，识别新出现的用户消息与 AI 回复；
  - 为每条消息记录：
    - 会话标识（URL 或从 URL 派生的 ID）；
    - 角色（user / assistant）；
    - 文本长度（例如字符数、字数等）；
    - 估算的 token 数（基于长度的简单规则）；
    - 模式（当前对话使用的 ChatGPT 模式）；
    - 时间戳（消息出现的时间）。
- 数据处理：
  - 按消息维度实时计算输入 / 输出 / 总 token；
  - 按会话维度汇总对话轮数与 token 用量；
  - 按时间维度（小时/天）进行基础聚合，便于后续图表展示。

#### 5.1.3 数据存储与清理

- 存储方式：
  - 全部统计数据保存在本地浏览器（如 `chrome.storage.local` 或 IndexedDB）；
  - 不上传到任何远程服务器。
- 数据保留策略：
  - 默认长期保留历史统计数据（无自动过期）；
  - 用户可以在 dashboard 中手动一键清空所有历史数据。

### 5.2 dashboard 表盘页面

#### 5.2.1 打开方式

- 用户点击 Chrome 工具栏中的扩展图标：
  - 直接打开（或切换到）一个 dashboard 网页标签页；
  - dashboard 页面加载本地存储的统计数据，并按默认时间范围展示。

#### 5.2.2 时间范围选择

- 支持的时间范围：
  - 最近 24 小时；
  - 最近 7 天；
  - 最近 30 天。
- 在页面顶部提供时间范围选择控件；
- 默认时间范围可在设计/实现阶段确定（如最近 7 天或最近 24 小时）。

#### 5.2.3 概览区（关键指标卡片）

在选定的时间范围内，展示以下核心指标（为 V1 必做）：

- 总输入 token（估算）；
- 总输出 token（估算）；
- 总 token（输入 + 输出）；
- 总对话轮数。

要求：

- 数值醒目、对比清晰；
- 在合适位置补充说明为 token 估算值。

#### 5.2.4 趋势区（曲线图）

在选定时间范围内，展示至少一条随时间变化的曲线图，用于反映用户使用习惯的变化趋势，例如：

- 按小时或按天聚合的总 token 曲线；
- 或按小时 / 按天聚合的对话轮数曲线。

要求：

- 能直观看到使用高峰与低谷；
- 在图例或说明中标注当前选择的时间粒度（如按小时/按天）；
- 在设计上为未来按模式分色展示预留空间（但 V1 可先做整体曲线）。

#### 5.2.5 模式与会话的基础统计

在选定时间范围内，提供基础的拆分与列表展示（可做精简版）：

- 按模式聚合：
  - 每个模式：总 token、占比（相对总 token）、对话轮数；
- 按会话聚合：
  - 列出近期会话列表（如最近 N 个会话）：
    - 会话开始时间；
    - 会话总 token；
    - 会话轮数；
    - 所属模式（如以会话中主要使用的模式为准）。

#### 5.2.6 设置与操作

- 一键清空数据：
  - 在 dashboard 中提供“清空所有统计数据”的按钮；
  - 执行前需弹出确认提示，以免误操作；
  - 清空后本地存储中相应数据删除，页面展示归零。
- 语言：
  - V1 仅支持中文界面；
  - 代码结构可以在合理程度上为未来 i18n 预留扩展点，但不强制。

## 6. 非功能性需求

### 6.1 性能

- 内容脚本与统计逻辑应尽量轻量，不明显拖慢 ChatGPT 页面加载与交互；
- 聚合与统计可在后台按需进行，避免在 DOM 事件上做重计算。

### 6.2 隐私与安全

- 不保存原始对话内容，仅保存必要的统计元数据；
- 所有数据仅存储在本地浏览器中，不进行任何形式的云端上传；
- 在产品文案中明确告知这一点，提升用户信任感。

### 6.3 可靠性

- 在 ChatGPT 页面结构有小幅变更时，应尽可能保持基本统计能力；
- 对于模式识别准确率，应容忍少量误差，并在内部实现中留有升级空间。

## 7. 后续扩展方向（非本期范围，仅做记录）

> 以下为后续版本的规划方向，当前 V1 不实现，仅作为 PRD 记录，未来可以逐步落地。

### 7.1 更精确的 token 统计

- 引入本地 tokenizer（如 BPE / Unigram 等），对 DOM 文本做更精确的 token 计算；
- 或通过采集样本数据与官方 usage 字段进行拟合，建立更准确的长度 → token 估算模型；
- 将这些能力作为付费版 / 专业版的核心卖点之一。

### 7.2 多平台与多形态支持

- 支持更多 AI 平台：
  - 豆包网页版；
  - API 调用（通过本地代理或 CLI wrapper）；
  - CLI 工具（如 Claude Code CLI）。
- 扩展到桌面应用 / 命令行工具的统计。

### 7.3 付费版与高级分析

- 在免费版基础上增加：
  - 更丰富的图表与分析维度（按模型 / 平台 / 时段的对比与拆分）；
  - 使用排行榜、最长会话、典型用量模式等；
  - 高级导出能力（CSV / 图片等）。
- 强调「更专业、更细致的 token 数据分析与呈现」，而不仅是视觉上的美化。
